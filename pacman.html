<!DOCTYPE html>
<html>
<head>
    <title></title>
</head>
<body class="monospaced">

<style type="text/css">
    @font-face {
        font-family:Consolas,monospace, Monaco,"Lucida Console","Liberation Mono","DejaVu Sans Mono","Bitstream Vera Sans Mono","Courier New";
    }
</style>

</body>
<script type="text/javascript">

    str = "";
    b = document.getElementsByTagName("body")[0];
    b.style.fontFamily = "Consolas, Monaco,\"Lucida Console\",\"Liberation Mono\",\"DejaVu Sans Mono\",\"Bitstream Vera Sans Mono\",\"Courier New\", monospace";
    b.innerHTML = "";
    ROW_MAX = 31;
    COL_MAX = 28;
    blinkySpeed = 1000;
    pacmanSpeed = 100;

    class Queue {
        constructor() {
            this.items = [];
        }
        isEmpty() {
            return this.items.length === 0;
        }
        enqueue(elements) {
            this.items.push(elements);
        }
        dequeue() {
            if(this.isEmpty())
                return "Underflow";
            return this.items.shift();
        }
        front() {
            if(this.isEmpty())
                return "No elements in Queue";
            return this.items[0];
        }
        printQueue() {
            var str = "";
            for(var i = 0; i < this.items.length; i++)
                str += "(" + this.items[0].pt.x.toString() + ", " + this.items[0].pt.y.toString() + "), " + this.items[0].dist + "; ";
            return str;
        }
    }

    function levelGenerator(level) {
        if(level === 1) {
            return ([
                ['B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B'],
                ['B', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'b', 'b', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'B'],
                ['B', 'p', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'p', 'B'],
                ['B', 'P', 'b', '0', '0', 'b', 'p', 'b', '0', '0', '0', 'b', 'p', 'b', 'b', 'p', 'b', '0', '0', '0', 'b', 'p', 'b', '0', '0', 'b', 'P', 'B'],
                ['B', 'p', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'p', 'B'],
                ['B', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'B'],
                ['B', 'p', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'p', 'B'],
                ['B', 'p', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'p', 'B'],
                ['B', 'p', 'p', 'p', 'p', 'p', 'p', 'b', 'b', 'p', 'p', 'p', 'p', 'b', 'b', 'p', 'p', 'p', 'p', 'b', 'b', 'p', 'p', 'p', 'p', 'p', 'p', 'B'],
                ['B', 'B', 'B', 'B', 'B', 'B', 'p', 'b', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'b', 'p', 'B', 'B', 'B', 'B', 'B', 'B'],
                ['0', '0', '0', '0', '0', 'B', 'p', 'b', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'b', 'p', 'B', '0', '0', '0', '0', '0'],
                ['0', '0', '0', '0', '0', 'B', 'p', 'b', 'b', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 'b', 'b', 'p', 'B', '0', '0', '0', '0', '0'],
                ['0', '0', '0', '0', '0', 'B', 'p', 'b', 'b', '0', 'B', 'B', 'B', '-', '-', 'B', 'B', 'B', '0', 'b', 'b', 'p', 'B', '0', '0', '0', '0', '0'],
                ['B', 'B', 'B', 'B', 'B', 'B', 'p', 'b', 'b', '0', 'B', '0', '0', '0', '0', '0', '0', 'B', '0', 'b', 'b', 'p', 'B', 'B', 'B', 'B', 'B', 'B'],
                ['0', '0', '0', '0', '0', '0', 'p', '0', '0', '0', 'B', '0', '0', '0', '0', '0', '0', 'B', '0', '0', '0', 'p', '0', '0', '0', '0', '0', '0'],
                ['B', 'B', 'B', 'B', 'B', 'B', 'p', 'b', 'b', '0', 'B', '0', '0', '0', '0', '0', '0', 'B', '0', 'b', 'b', 'p', 'B', 'B', 'B', 'B', 'B', 'B'],
                ['0', '0', '0', '0', '0', 'B', 'p', 'b', 'b', '0', 'B', 'B', 'B', '-', '-', 'B', 'B', 'B', '0', 'b', 'b', 'p', 'B', '0', '0', '0', '0', '0'],
                ['0', '0', '0', '0', '0', 'B', 'p', 'b', 'b', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 'b', 'b', 'p', 'B', '0', '0', '0', '0', '0'],
                ['0', '0', '0', '0', '0', 'B', 'p', 'b', 'b', '0', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', '0', 'b', 'b', 'p', 'B', '0', '0', '0', '0', '0'],
                ['B', 'B', 'B', 'B', 'B', 'B', 'p', 'b', 'b', '0', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', '0', 'b', 'b', 'p', 'B', 'B', 'B', 'B', 'B', 'B'],
                ['B', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'b', 'b', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'B'],
                ['B', 'p', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'p', 'B'],
                ['B', 'p', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'p', 'B'],
                ['B', 'P', 'p', 'p', 'b', 'b', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'b', 'b', 'p', 'p', 'P', 'B'],
                ['B', 'B', 'B', 'p', 'b', 'b', 'p', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'p', 'b', 'b', 'p', 'B', 'B', 'B'],
                ['B', 'B', 'B', 'p', 'b', 'b', 'p', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'p', 'b', 'b', 'p', 'B', 'B', 'B'],
                ['B', 'p', 'p', 'p', 'p', 'p', 'p', 'b', 'b', 'p', 'p', 'p', 'p', 'b', 'b', 'p', 'p', 'p', 'p', 'b', 'b', 'p', 'p', 'p', 'p', 'p', 'p', 'B'],
                ['B', 'p', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'p', 'B'],
                ['B', 'p', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'p', 'b', 'b', 'p', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'b', 'p', 'B'],
                ['B', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'p', 'B'],
                ['B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B']
            ]);
        }
    }
    function generateVisited() {
        var visited = [], temp = [], i, j;
        for(i = 0; i < ROW_MAX; i++)
        {
            temp = [];
            for(j = 0; j < COL_MAX; j++)
                temp.push(0);
            visited[i] = temp;
        }
        return visited;
    }

    function isValid(row, col)
    {
        // return true if row pacmanInterval and column pacmanInterval is in range
        return ((row >= 0) && (row < ROW_MAX) && (col >= 0) && (col < COL_MAX));
    }

    // These arrays are used to get row and column
    // pacmanIntervals of 4 neighbours of a given cell
    rowNum = [-1, 0, 0, 1];
    colNum = [0, -1, 1, 0];

    function findPath(matrix, blinkyPos, pacmanPos, pathToPacman, blinkyMotionDirection) {
        // check source and destination cell
        // of the matrix have value 1
        if (!(matrix[blinkyPos.x][blinkyPos.y] === '-' || matrix[blinkyPos.x][blinkyPos.y] === '0' || matrix[pacmanPos.x][pacmanPos.y] === '0' || matrix[blinkyPos.x][blinkyPos.y] === 'p' || matrix[pacmanPos.x][pacmanPos.y] === 'p' || matrix[blinkyPos.x][blinkyPos.y] === 'P' || matrix[pacmanPos.x][pacmanPos.y] === 'P')) {
            return -1;
        }

//        bool visited[ROW][COL];
//        memset(visited, false, sizeof visited);
        var visited = generateVisited();

        // Mark the source cell as visited
        visited[blinkyPos.x][blinkyPos.y] = 1;

        // Create a queue for BFS
        var q = new Queue();

        // distance of source cell is 0
        var s = {pt: blinkyPos, dist: 0};
        q.enqueue(s);  // Enqueue source cell

        var count = 0, str3 = "", temp = [];
        // Do a BFS starting from source cell
        while (q.isEmpty() !== true)
        {
            var curr = q.front();
            var pt = curr.pt;

            temp[count++] = curr;
//            console.log(q.printQueue())
//            console.log(pathToPacman[count-1].printQueue());
            // If we have reached the destination cell,
            // we are done
            if (pt.x === pacmanPos.x && pt.y === pacmanPos.y) {
//                for(var k = 0; k < temp.length; k++)
//                    str3 += "(" + temp[k].pt.x.toString() + ", " + temp[k].pt.y.toString() + "), " + temp[k].dist + "; ";
//
//                str3 += "<br><br><br><br>";

                var earlierPoint = temp[temp.length - 1];
                for(var l = temp.length - 2; l >= 0; l--) {
                    if((temp[l].pt.x === earlierPoint.pt.x && Math.abs(temp[l].pt.y - earlierPoint.pt.y) === 1) || (temp[l].pt.y === earlierPoint.pt.y && Math.abs(temp[l].pt.x - earlierPoint.pt.x) === 1)) {
                        pathToPacman.push(temp[l].pt);
                        earlierPoint = temp[l];
//                        str3 += "(" + temp[l].pt.x.toString() + ", " + temp[l].pt.y.toString() + "), " + temp[l].dist + "; ";
                    }
                }
//                b.innerHTML += str3;
                pathToPacman = pathToPacman.reverse();
                pathToPacman.push(pacmanPos);
//                console.log(pathToPacman);

                return curr.dist;
            }

            // Otherwise dequeue the front cell in the queue
            // and enqueue its adjacent cells
            q.dequeue();

            for (var i = 0; i < 4; i++)
            {
                if(count === 1 && blinkyMotionDirection.x === -1 * rowNum[i] && blinkyMotionDirection.y === -1 * colNum[i])
                    continue;
                var row = pt.x + rowNum[i];
                var col = pt.y + colNum[i];

                // if adjacent cell is valid, has path and
                // not visited yet, enqueue it.
                if (isValid(row, col) === true && (matrix[row][col] === 'p' || matrix[row][col] === 'P' || matrix[row][col] === '-' || matrix[row][col] === '0') && visited[row][col] === 0)
                {
                    // mark cell as visited and enqueue it
                    visited[row][col] = 1;
                    var Adjcell = {pt: {x: row, y: col}, dist: curr.dist + 1};
                    q.enqueue(Adjcell);
                }
            }
        }

        return -1;// if destination cannot be reached
    }

    function moveBlinky(matrix, matrixCopy, currentPos, pacmanPos, blinkyMotionDirection) {
        if(currentPos.x === pacmanPos.x && currentPos.y === pacmanPos.y) {
            clearInterval(pacmanInterval);
            clearInterval(blinkyInterval);
            b.innerHTML = "<h1>Game Over</h1>";
        }
        var temp, pathToPacman = [];
        findPath(matrix, currentPos, pacmanPos, pathToPacman, blinkyMotionDirection);
        if(matrix[pathToPacman[0].x][pathToPacman[0].y] === 'p')
            temp = '.';
        else if(matrix[pathToPacman[0].x][pathToPacman[0].y] === 'P')
            temp = 'O';
        else if(matrix[pathToPacman[0].x][pathToPacman[0].y] === '0')
            temp = ' ';
        else if(matrix[pathToPacman[0].x][pathToPacman[0].y] === 'B')
            temp = '#';
        else if(matrix[pathToPacman[0].x][pathToPacman[0].y] === 'b')
            temp = '*';
        else if(matrix[pathToPacman[0].x][pathToPacman[0].y] === '-')
            temp = '_';
        matrixCopy[pathToPacman[0].x][pathToPacman[0].y] = temp;
        matrixCopy[pathToPacman[1].x][pathToPacman[1].y] = 'g';

        blinkyMotionDirection.x = pathToPacman[1].x - pathToPacman[0].x;
        console.log(blinkyMotionDirection.x, " = ", pathToPacman[1].x, " - ", pathToPacman[0].x);
        // blinkyMotionDirection.y equals 1 => going right, blinkyMotionDirection.y equals -1 => going left, blinkyMotionDirection.y equals 0 => no change in 'y' direction
        blinkyMotionDirection.y = pathToPacman[1].y - pathToPacman[0].y;
        console.log(blinkyMotionDirection.y, " = ", pathToPacman[1].y, " - ", pathToPacman[0].y);

        if(pathToPacman.length === 1)
            return "gameOver";
        currentPos.x = pathToPacman[1].x;
        currentPos.y = pathToPacman[1].y;

        return currentPos;
    }

    function movePacman(matrix, matrixCopy, pacmanPos, blinkyPos) {
        var map = {};
        onkeydown = onkeyup = function(event) {
            event = event || event;
            map[event.keyCode] = event.type == 'keydown';
            if (map[37] == true || map[38] == true || map[39] == true || map[40] == true) {
                if(blinkyPos.x === pacmanPos.x && blinkyPos.y === pacmanPos.y) {
                    clearInterval(pacmanInterval);
                    clearInterval(blinkyInterval);
                    b.innerHTML = "<h1>Game Over</h1>";
                }
                if (map[38] == true) {
                    if (pacmanPos.x - 1 >= 0 && pacmanPos.x - 1 < ROW_MAX && pacmanPos.y >= 0 && pacmanPos.y < COL_MAX && (matrix[pacmanPos.x - 1][pacmanPos.y] === 'p' || matrix[pacmanPos.x - 1][pacmanPos.y] === 'P' || matrix[pacmanPos.x - 1][pacmanPos.y] === '0')) {
                        matrix[pacmanPos.x][pacmanPos.y] = '0';
                        matrixCopy[pacmanPos.x][pacmanPos.y] = ' ';
                        matrixCopy[--pacmanPos.x][pacmanPos.y] = '@';
                    }
                }
                if (map[37] == true) {
                    if (pacmanPos.x >= 0 && pacmanPos.x < ROW_MAX && pacmanPos.y - 1 >= 0 && pacmanPos.y - 1 < COL_MAX && (matrix[pacmanPos.x][pacmanPos.y - 1] === 'p' || matrix[pacmanPos.x][pacmanPos.y - 1] === 'P' || matrix[pacmanPos.x][pacmanPos.y - 1] === '0')) {
                        matrix[pacmanPos.x][pacmanPos.y] = '0';
                        matrixCopy[pacmanPos.x][pacmanPos.y] = ' ';
                        matrixCopy[pacmanPos.x][--pacmanPos.y] = '@';
                    }
                }
                if (map[40] == true) {
                    if (pacmanPos.x + 1 >= 0 && pacmanPos.x + 1 < ROW_MAX && pacmanPos.y >= 0 && pacmanPos.y < COL_MAX && (matrix[pacmanPos.x + 1][pacmanPos.y] === 'p' || matrix[pacmanPos.x + 1][pacmanPos.y] === 'P' || matrix[pacmanPos.x + 1][pacmanPos.y] === '0')) {
                        matrix[pacmanPos.x][pacmanPos.y] = '0';
                        matrixCopy[pacmanPos.x][pacmanPos.y] = ' ';
                        matrixCopy[++pacmanPos.x][pacmanPos.y] = '@';
                    }
                }
                if (map[39] == true) {
                    if (pacmanPos.x >= 0 && pacmanPos.x < ROW_MAX && pacmanPos.y + 1 >= 0 && pacmanPos.y + 1 < COL_MAX && (matrix[pacmanPos.x][pacmanPos.y + 1] === 'p' || matrix[pacmanPos.x][pacmanPos.y + 1] === 'P' || matrix[pacmanPos.x][pacmanPos.y + 1] === '0')) {
                        matrix[pacmanPos.x][pacmanPos.y] = '0';
                        matrixCopy[pacmanPos.x][pacmanPos.y] = ' ';
                        matrixCopy[pacmanPos.x][++pacmanPos.y] = '@';
                    }
                }
            }
        };
        str = "<pre>";
        b.innerHTML = "";
        for(var i = 0; i < ROW_MAX; i++)
        {
            for(var j = 0; j < COL_MAX; j++)
                str = str + matrixCopy[i][j].toString() + " ";
            // str = str + "\n";
            str = str + "<br>";
        }
        str += "<pre>";
        b.innerHTML += str;
    }

    function main() {
        var i, j;

        var blinkyPos = {x: 15, y: 13};
        var pacmanPos = {x: 26, y: 15};

        var matrix = levelGenerator(1);
        var matrixCopy = levelGenerator(1);

        for(i = 0; i < ROW_MAX; i++) {
            for(j = 0; j < COL_MAX; j++) {
                if(matrix[i][j] === 'p')
                    matrixCopy[i][j] = '.';
                else if(matrix[i][j] === 'P')
                    matrixCopy[i][j] = 'O';
                else if(matrix[i][j] === '0')
                    matrixCopy[i][j] = ' ';
                else if(matrix[i][j] === 'B')
                    matrixCopy[i][j] = '#';
                else if(matrix[i][j] === 'b')
                    matrixCopy[i][j] = '*';
                else if(matrix[i][j] === '-')
                    matrixCopy[i][j] = '_';
            }
        }
        matrixCopy[pacmanPos.x][pacmanPos.y] = '@';

        pacmanInterval = setInterval(function() {
            movePacman(matrix, matrixCopy, pacmanPos, blinkyPos);
        }, pacmanSpeed);
        var blinkyMotionDirection = {x: -1, y: 0};
        blinkyInterval = setInterval(function() {
            console.log(blinkyMotionDirection.x, " && ", blinkyMotionDirection.y);
            blinkyPos = moveBlinky(matrix, matrixCopy, blinkyPos, pacmanPos, blinkyMotionDirection);
            if(blinkyPos === "gameOver") {
                clearInterval(pacmanInterval);
                clearInterval(blinkyInterval);
                b.innerHTML = "<h1>Game Over</h1>";
            }
        }, blinkySpeed);
    }
    main();
</script>
</html>